@{
    ViewData["Title"] = "Review Comic";
    Layout = "~/Views/Shared/_ModeratorLayout.cshtml";
}

@model ComicModeration

<div class="admin-main">
    <div class="flex justify-between items-center" style="margin-bottom: 2rem;">
        <h1 style="margin-bottom: 0;">Review Comic</h1>
        <a href="@Url.Action("Pending", "Moderation")" class="btn btn-outline">Back to Pending</a>
    </div>

    @if (Model != null)
    {
        <div style="display: grid; grid-template-columns: 300px 1fr; gap: 2rem;">
            <!-- Comic Cover -->
            <div>
                <img src="@Model.Comic.CoverImage" alt="@Model.Comic.Title"
                    style="width: 100%; border-radius: var(--radius-md); margin-bottom: 1rem;">
                <div class="table-container" style="padding: 1.5rem;">
                    <h3>Comic Info</h3>
                    <div style="margin-top: 1rem;">
                        <p style="color: var(--text-muted); font-size: 0.9rem;">Author ID</p>
                        <p style="font-weight: 500;">@Model.Comic.AuthorId</p>
                    </div>
                    <div style="margin-top: 1rem;">
                        <p style="color: var(--text-muted); font-size: 0.9rem;">Created Date</p>
                        <p style="font-weight: 500;">@Model.Comic.CreatedAt.ToString("MMM dd, yyyy HH:mm")</p>
                    </div>
                    <div style="margin-top: 1rem;">
                        <p style="color: var(--text-muted); font-size: 0.9rem;">Current Status</p>
                        <span class="badge badge-warning">@Model.ModerationStatus</span>
                    </div>
                </div>
            </div>

            <!-- Comic Details -->
            <div>
                <div class="table-container" style="padding: 2rem;">
                    <h2 style="margin-bottom: 1rem;">@Model.Comic.Title</h2>
                    
                    <div style="margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 0.5rem;">Description</h3>
                        <p style="color: var(--text-secondary); line-height: 1.6;">
                            @Model.Comic.Description
                        </p>
                    </div>

                    <div style="margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 0.5rem;">Moderation History</h3>
                        @{
                            var history = ViewBag.ModerationHistory as List<ComicModeration>;
                            if (history?.Any() == true)
                            {
                                @foreach (var h in history)
                                {
                                    <div style="padding: 1rem; background: var(--bg-main); border-radius: var(--radius-sm); margin-bottom: 0.5rem;">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: 500;">@h.ModerationStatus</span>
                                            <span style="color: var(--text-muted); font-size: 0.9rem;">
                                                @h.ProcessedAt?.ToString("MMM dd, yyyy HH:mm")
                                            </span>
                                        </div>
                                        @if (!string.IsNullOrEmpty(h.Note))
                                        {
                                            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem;">
                                                Reason: @h.Note
                                            </p>
                                        }
                                    </div>
                                }
                            }
                            else
                            {
                                <p style="color: var(--text-muted);">No history yet.</p>
                            }
                        }
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <form action="@Url.Action("Approve", "Moderation", new { id = Model.ComicModerationId })" method="post" style="display: inline;">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-primary">
                                <i class="ph ph-check-circle" style="margin-right: 0.5rem;"></i> Approve
                            </button>
                        </form>
                        <button type="button" class="btn btn-outline" onclick="showRejectModal();">
                            <i class="ph ph-x-circle" style="margin-right: 0.5rem;"></i> Reject
                        </button>
                        <button type="button" class="btn btn-outline" style="color: var(--color-danger);" onclick="showHideModal();">
                            <i class="ph ph-eye-slash" style="margin-right: 0.5rem;"></i> Hide
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reject Modal -->
        <div id="rejectModal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>Reject Comic</h2>
                <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                    Please provide a reason for rejecting this comic.
                </p>
                <form action="@Url.Action("Reject", "Moderation", new { id = Model.ComicModerationId })" method="post">
                    @Html.AntiForgeryToken()
                    <div style="margin-bottom: 1rem;">
                        <textarea name="reason" placeholder="Enter rejection reason..." 
                            style="width: 100%; padding: 0.75rem; background: var(--bg-main); border: 1px solid var(--border-color); 
                            border-radius: var(--radius-sm); color: var(--text-primary); font-family: var(--font-body);" 
                            rows="4" required></textarea>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button type="submit" class="btn btn-primary">Submit Rejection</button>
                        <button type="button" class="btn btn-ghost" onclick="closeRejectModal();">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Hide Modal -->
        <div id="hideModal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>Hide Comic</h2>
                <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                    Please provide a reason for hiding this comic (violation reason).
                </p>
                <form action="@Url.Action("Hide", "Moderation", new { id = Model.ComicModerationId })" method="post">
                    @Html.AntiForgeryToken()
                    <div style="margin-bottom: 1rem;">
                        <textarea name="reason" placeholder="Enter hiding reason..." 
                            style="width: 100%; padding: 0.75rem; background: var(--bg-main); border: 1px solid var(--border-color); 
                            border-radius: var(--radius-sm); color: var(--text-primary); font-family: var(--font-body);" 
                            rows="4" required></textarea>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button type="submit" class="btn btn-primary" style="background: var(--color-danger);">Confirm Hide</button>
                        <button type="button" class="btn btn-ghost" onclick="closeHideModal();">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal Overlay -->
        <div id="modalOverlay" class="modal-overlay" style="display: none;" onclick="closeModals();"></div>
    }
    else
    {
        <div class="table-container" style="padding: 2rem; text-align: center;">
            <p>Comic not found.</p>
        </div>
    }
</div>

@section Styles {
    <style>
        .admin-main {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
        }

        .table-container {
            background: var(--bg-surface);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-surface);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            padding: 2rem;
            z-index: 1001;
            max-width: 500px;
            width: 90%;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        textarea {
            resize: vertical;
        }
    </style>
}

@section Scripts {
    <script>
        function showRejectModal() {
            document.getElementById('rejectModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        }

        function closeRejectModal() {
            document.getElementById('rejectModal').style.display = 'none';
            document.getElementById('modalOverlay').style.display = 'none';
        }

        function showHideModal() {
            document.getElementById('hideModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        }

        function closeHideModal() {
            document.getElementById('hideModal').style.display = 'none';
            document.getElementById('modalOverlay').style.display = 'none';
        }

        function closeModals() {
            closeRejectModal();
            closeHideModal();
        }
    </script>
}